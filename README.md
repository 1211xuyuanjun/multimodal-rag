# å¤šæ¨¡æ€æ™ºèƒ½ä½“RAGç³»ç»Ÿ

åŸºäºQwen-Agentæ¡†æ¶æ„å»ºçš„å¤šæ¨¡æ€æ£€ç´¢å¢å¼ºç”Ÿæˆ(RAG)ç³»ç»Ÿï¼Œä¸“é—¨å¤„ç†åŒ…å«Markdownæ–‡ä»¶å’Œå›¾ç‰‡çš„æ–‡ä»¶å¤¹ï¼Œæ”¯æŒæ–‡æœ¬ã€å›¾ç‰‡ç­‰å¤šæ¨¡æ€å†…å®¹çš„è§£æã€æ£€ç´¢å’Œé—®ç­”ã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

- ğŸ“ **æ–‡ä»¶å¤¹è¾“å…¥**: æ”¯æŒåŒ…å«MDæ–‡ä»¶å’Œimagesæ–‡ä»¶å¤¹çš„ç›®å½•ç»“æ„
- ğŸ“ **Markdownè§£æ**: æ™ºèƒ½è§£æMarkdownæ–‡æ¡£ï¼Œæå–æ–‡æœ¬å’Œå›¾ç‰‡å¼•ç”¨
- ğŸ–¼ï¸ **å›¾ç‰‡å¤„ç†**: è‡ªåŠ¨å¤„ç†imagesæ–‡ä»¶å¤¹ä¸­è¢«å¼•ç”¨çš„å›¾ç‰‡
- ğŸ” **æ™ºèƒ½æ£€ç´¢**: æ”¯æŒæ–‡æœ¬å’Œå›¾åƒçš„æ··åˆæ£€ç´¢
- ğŸ’¬ **å¤šæ¨¡æ€é—®ç­”**: åŸºäºæ–‡æ¡£å†…å®¹è¿›è¡Œæ™ºèƒ½é—®ç­”
- ğŸŒ **Webç•Œé¢**: å‹å¥½çš„Gradioç•Œé¢ï¼Œæ”¯æŒæ–‡ä»¶å¤¹è·¯å¾„è¾“å…¥

## ğŸ“‹ æ–‡ä»¶å¤¹ç»“æ„è¦æ±‚

ç³»ç»Ÿéœ€è¦ä»¥ä¸‹æ–‡ä»¶å¤¹ç»“æ„ï¼š

```
your_folder/
â”œâ”€â”€ document.md          # ä¸»è¦çš„Markdownæ–‡æ¡£
â””â”€â”€ images/             # å›¾ç‰‡æ–‡ä»¶å¤¹ï¼ˆå¯é€‰ï¼‰
    â”œâ”€â”€ image1.png
    â”œâ”€â”€ image2.jpg
    â””â”€â”€ ...
```

### æ”¯æŒçš„æ ¼å¼

- **Markdownæ–‡ä»¶**: `.md`, `.markdown`
- **å›¾ç‰‡æ ¼å¼**: `.jpg`, `.jpeg`, `.png`, `.gif`, `.bmp`, `.webp`
- **å›¾ç‰‡å¼•ç”¨**: ç³»ç»Ÿä¼šè‡ªåŠ¨åŒ¹é…MDæ–‡ä»¶ä¸­çš„å›¾ç‰‡å¼•ç”¨ä¸imagesæ–‡ä»¶å¤¹ä¸­çš„å®é™…å›¾ç‰‡

## ğŸš€ ä¸»è¦åŠŸèƒ½

- ğŸ“ **æ–‡ä»¶å¤¹è§£æ**: æ™ºèƒ½è¯†åˆ«å’Œè§£ææ–‡ä»¶å¤¹ç»“æ„
- ğŸ“ **Markdownå¤„ç†**: å®Œæ•´çš„Markdownè¯­æ³•æ”¯æŒï¼ŒåŒ…æ‹¬å›¾ç‰‡å¼•ç”¨
- ğŸ–¼ï¸ **å›¾ç‰‡åˆ†æ**: ä½¿ç”¨å¤šæ¨¡æ€æ¨¡å‹åˆ†æå›¾ç‰‡å†…å®¹
- ğŸ” **æ··åˆæ£€ç´¢**: ç»“åˆæ–‡æœ¬æœç´¢å’Œå›¾åƒæœç´¢
- ğŸ’¬ **æ™ºèƒ½é—®ç­”**: åŸºäºæ–‡æ¡£å†…å®¹çš„å¤šæ¨¡æ€é—®ç­”
- ğŸŒ **Webç•Œé¢**: ç®€æ´æ˜“ç”¨çš„Gradioç•Œé¢

## ç³»ç»Ÿæ¶æ„

```
å¤šæ¨¡æ€æ™ºèƒ½ä½“RAGç³»ç»Ÿ
â”œâ”€â”€ æ–‡æ¡£è§£æå±‚ (Document Parser)
â”‚   â”œâ”€â”€ æ–‡ä»¶å¤¹è§£æå™¨ (Folder Parser)
â”‚   â”œâ”€â”€ Markdownè§£æå™¨ (Markdown Parser)
â”‚   â””â”€â”€ å›¾ç‰‡æå–å™¨ (Image Extractor)
â”œâ”€â”€ æ–‡æ¡£å¤„ç†å±‚ (Document Processor)
â”‚   â”œâ”€â”€ æ™ºèƒ½åˆ†å—å™¨ (Smart Chunker)
â”‚   â””â”€â”€ å¤šæ¨¡æ€é¢„å¤„ç† (Multimodal Preprocessor)
â”œâ”€â”€ å­˜å‚¨å±‚ (Storage Layer)
â”‚   â”œâ”€â”€ å‘é‡æ•°æ®åº“ (Vector Database)
â”‚   â””â”€â”€ å…ƒæ•°æ®å­˜å‚¨ (Metadata Store)
â”œâ”€â”€ æ£€ç´¢å±‚ (Retrieval Layer)
â”‚   â”œâ”€â”€ æ··åˆæ£€ç´¢å™¨ (Hybrid Retriever)
â”‚   â”œâ”€â”€ é‡æ’åºå™¨ (Reranker)
â”‚   â””â”€â”€ æŸ¥è¯¢ä¼˜åŒ–å™¨ (Query Optimizer)
â””â”€â”€ ç”Ÿæˆå±‚ (Generation Layer)
    â”œâ”€â”€ å¤šæ¨¡æ€LLM (Multimodal LLM)
    â””â”€â”€ å›ç­”ç”Ÿæˆå™¨ (Answer Generator)
```

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Python 3.8+
- CUDA (å¯é€‰ï¼Œç”¨äºGPUåŠ é€Ÿ)

### å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```



### é…ç½®APIå¯†é’¥

åˆ›å»º `dashscope_key.txt` æ–‡ä»¶ï¼Œæ·»åŠ æ‚¨çš„Dashscope APIå¯†é’¥ï¼š

```
your-dashscope-api-key-here
```

### Webç•Œé¢ä½¿ç”¨ï¼ˆæ¨èï¼‰

å¯åŠ¨Webç•Œé¢ï¼š

```bash
# æ–¹å¼1ï¼šç›´æ¥å¯åŠ¨
python webui.py

# æ–¹å¼2ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆWindowsï¼‰
start_webui.bat
```

å¯åŠ¨ååœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼š`http://localhost:7860`

**Webç•Œé¢åŠŸèƒ½**ï¼š
- ğŸ“ **æ–‡ä»¶å¤¹ç®¡ç†**ï¼šè¾“å…¥åŒ…å«MDæ–‡ä»¶å’Œimagesæ–‡ä»¶å¤¹çš„ç›®å½•è·¯å¾„
- ğŸ’¬ **æ™ºèƒ½é—®ç­”**ï¼šæ”¯æŒåŸºäºæ–‡æ¡£å†…å®¹çš„å¤šæ¨¡æ€é—®ç­”
- ğŸ“Š **ç³»ç»ŸçŠ¶æ€**ï¼šå®æ—¶æŸ¥çœ‹æ–‡æ¡£å¤„ç†çŠ¶æ€å’Œå­˜å‚¨ä¿¡æ¯
- ğŸ” **æ™ºèƒ½æ£€ç´¢**ï¼šè‡ªåŠ¨åˆ†ææŸ¥è¯¢å¹¶è¿›è¡Œæ··åˆæ£€ç´¢

è¯¦ç»†ä½¿ç”¨è¯´æ˜è¯·å‚è€ƒï¼š[Webç•Œé¢ä½¿ç”¨æŒ‡å—](webui_guide.md)

### ç¼–ç¨‹æ¥å£ä½¿ç”¨

```python
from multimodal_rag.agent import MultimodalRAGAgent

# åˆå§‹åŒ–æ™ºèƒ½ä½“
agent = MultimodalRAGAgent(
    llm_config={
        'model': 'qwen-plus',
        'api_key': 'your-api-key'
    }
)

# æ·»åŠ æ–‡ä»¶å¤¹
agent.add_documents(['./data/detective'])  # åŒ…å«MDæ–‡ä»¶å’Œimagesæ–‡ä»¶å¤¹çš„ç›®å½•

# æ™ºèƒ½æŸ¥è¯¢ - æ”¯æŒå¤šæ¨¡æ€é—®ç­”
result = agent.query_detailed("åˆ†æè¿™ä¸ªæ–‡æ¡£çš„ä¸»è¦è§‚ç‚¹ï¼Œå¹¶ç»“åˆå›¾ç‰‡å†…å®¹è¿›è¡Œè¯´æ˜")
print(result['answer'])

# ç®€å•æŸ¥è¯¢
answer = agent.query("è¿™ä¸ªæ–‡æ¡£çš„ä¸»è¦å†…å®¹æ˜¯ä»€ä¹ˆï¼Ÿ")
print(answer)

# å›¾ç‰‡ç›¸å…³æŸ¥è¯¢
image_answer = agent.query("æ–‡æ¡£ä¸­çš„å›¾ç‰‡å±•ç¤ºäº†ä»€ä¹ˆå†…å®¹ï¼Ÿ")
print(image_answer)
```

## é¡¹ç›®ç»“æ„

```
muti_agent_rag/
â”œâ”€â”€ multimodal_rag/              # æ ¸å¿ƒæ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ agent.py                 # ä¸»æ™ºèƒ½ä½“
â”‚   â”œâ”€â”€ parsers/                 # æ–‡æ¡£è§£æå™¨
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ folder_parser.py     # æ–‡ä»¶å¤¹è§£æå™¨
â”‚   â”‚   â”œâ”€â”€ markdown_parser.py   # Markdownè§£æå™¨
â”‚   â”‚   â”œâ”€â”€ image_extractor.py   # å›¾ç‰‡æå–å™¨
â”‚   â”‚   â””â”€â”€ ocr_engine.py        # OCRå¼•æ“
â”‚   â”œâ”€â”€ processors/              # æ–‡æ¡£å¤„ç†å™¨
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ smart_chunker.py
â”‚   â”œâ”€â”€ storage/                 # å­˜å‚¨æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ vector_store.py
â”‚   â”‚   â””â”€â”€ metadata_store.py
â”‚   â”œâ”€â”€ retrieval/               # æ£€ç´¢æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ hybrid_retriever.py
â”‚   â”‚   â”œâ”€â”€ reranker.py
â”‚   â”‚   â””â”€â”€ query_optimizer.py
â”‚   â””â”€â”€ generation/              # ç”Ÿæˆæ¨¡å—
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ multimodal_llm.py
â”‚       â””â”€â”€ answer_generator.py
â”œâ”€â”€ examples/                    # ç¤ºä¾‹ä»£ç 
â”œâ”€â”€ tests/                       # æµ‹è¯•ç”¨ä¾‹
â”œâ”€â”€ docs/                        # æ–‡æ¡£
â”œâ”€â”€ requirements.txt             # ä¾èµ–åˆ—è¡¨
â””â”€â”€ README.md                    # é¡¹ç›®è¯´æ˜
```



## ä½¿ç”¨ç¤ºä¾‹

### æ–‡ä»¶å¤¹ç»“æ„ç¤ºä¾‹

```
data/detective/
â”œâ”€â”€ detective.md        # ä¸»è¦æ–‡æ¡£
â””â”€â”€ images/            # å›¾ç‰‡æ–‡ä»¶å¤¹
    â”œâ”€â”€ cover.jpg
    â”œâ”€â”€ character.png
    â””â”€â”€ scene.gif
```

### å¿«é€Ÿæµ‹è¯•

```bash
# æµ‹è¯•æ–‡ä»¶å¤¹è§£æ
python demo_folder_input.py

# å¯åŠ¨Webç•Œé¢
python webui.py
```

## æŠ€æœ¯æ ˆ

- **åŸºç¡€æ¡†æ¶**: Qwen-Agent
- **æ–‡æ¡£è§£æ**: Markdown, å›¾ç‰‡æå–, OCR
- **å‘é‡å­˜å‚¨**: FAISS, ChromaDB
- **å¤šæ¨¡æ€æ¨¡å‹**: Qwen-VL, CLIP
- **æ£€ç´¢ç®—æ³•**: BM25, Dense Retrieval
- **é‡æ’åº**: Cross-encoder models
- **Webç•Œé¢**: Gradio

## å¼€å‘è®¡åˆ’

- [x] é¡¹ç›®æ¶æ„è®¾è®¡
- [x] æ–‡ä»¶å¤¹è§£æå™¨å®ç°
- [x] Markdownæ–‡æ¡£è§£æ
- [x] å›¾ç‰‡æå–å’Œå¤„ç†
- [x] å¤šæ¨¡æ€å‘é‡å­˜å‚¨
- [x] æ··åˆæ£€ç´¢å’Œé‡æ’åº
- [x] æŸ¥è¯¢é‡å†™å’Œä¼˜åŒ–
- [x] LLMé—®ç­”ç”Ÿæˆ
- [x] Webç•Œé¢å®ç°
- [ ] æ€§èƒ½ä¼˜åŒ–å’Œæµ‹è¯•å®Œå–„

## è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›é¡¹ç›®ã€‚

## è®¸å¯è¯

MIT License
